FROM ansibleplaybookbundle/apb-src-base
# MAINTAINER {{ $MAINTAINER }}

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"=\
"aWQ6IGYzMmRlM2JjLTMyMjUtNDI5YS1iMjNiLWNlZjQ3Y2ExZDI1YgpuYW1lOiBldGhlcnBhZC1h\
cGIKaW1hZ2U6IGpraWcvZXRoZXJwYWQtYXBiCmRlc2NyaXB0aW9uOiBOb3RlIHRha2luZyB3ZWIg\
YXBwbGljYXRpb24KYmluZGFibGU6IHRydWUKYXN5bmM6ICJvcHRpb25hbCIKcGFyYW1ldGVyczoK\
ICAtIG5hbWU6IHByb2plY3RfbmFtZQogICAgZGVzY3JpcHRpb246IE5hbWVzcGFjZSB0byBkZXBs\
b3kgY29udGFpbmVycyB0bwogICAgZGVmYXVsdDogZXRoZXJwYWQKICAtIG5hbWU6IGRhdGFiYXNl\
X3VzZXIKICAgIGRlc2NyaXB0aW9uOiBEYXRhYmFzZSBVc2VyCiAgICBkZWZhdWx0OiBldGhlcnBh\
ZAogIC0gbmFtZTogZGF0YWJhc2VfcGFzc3dvcmQKICAgIGRlc2NyaXB0aW9uOiBEYXRhYmFzZSBQ\
YXNzd29yZAogICAgZGVmYXVsdDogYWRtaW4KICAtIG5hbWU6IGRhdGFiYXNlX25hbWUKICAgIGRl\
c2NyaXB0aW9uOiBEYXRhYmFzZSBOYW1lCiAgICBkZWZhdWx0OiBldGhlcnBhZAogIC0gbmFtZTog\
ZGF0YWJhc2VfaG9zdAogICAgZGVzY3JpcHRpb246IERhdGFiYXNlIHNlcnZpY2UgaG9zdG5hbWUv\
aXAKICAgIGRlZmF1bHQ6IG1hcmlhZGIKICAtIG5hbWU6IHJvb3RfcGFzc3dvcmQKICAgIGRlc2Ny\
aXB0aW9uOiByb290IHBhc3N3b3JkIGZvciBtYXJpYWRiIGNvbnRhaW5lcgogICAgZGVmYXVsdDog\
YWRtaW4KICAtIG5hbWU6IGFwcGxpY2F0aW9uX3Bhc3N3b3JkCiAgICBkZXNjcmlwdGlvbjogUGFz\
c3dvcmQgZm9yIGV0aGVycGFkLWxpdGUgYWRtaW4gaW50ZXJmYWNlCiAgICBkZWZhdWx0OiBhZG1p\
bgogIC0gbmFtZTogc2Vzc2lvbl9rZXkKICAgIGRlc2NyaXB0aW9uOiBLZXkgZm9yIHJlY292ZXJp\
bmcgc2Vzc2lvbi4gV2lsbCBkZWZhdWx0IHRvIHJhbmRvbSBVVUlECiAgICBkZWZhdWx0OiB0ZXN0\
CiAgICByZXF1aXJlZDogZmFsc2UK"

ADD playbooks /opt/apb/actions
ADD roles /opt/ansible/roles

RUN useradd -u 1001 -r -g 0 -M -b /opt/apb -s /sbin/nologin -c "apb user" apb
RUN chown -R 1001:0 /opt/apb
USER 1001
